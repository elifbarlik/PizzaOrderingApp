@page "/pizzas/{id}"
@inject Pitzam.Services.PizzaService PizzaService
@inject Pitzam.Services.OrderStateService OrderStateService
@inject NavigationManager Navigation
@using Pitzam.Models

@* ... (HTML kısmı aynı kalabilir) ... *@
<h3>@selectedPizza?.Name</h3>

@if (selectedPizza == null)
{
    <p>Pizza bulunamadı.</p>
}
else
{
    <PizzaCustomer Pizza="selectedPizza" OnOrderReady="HandleOrderReady" />
}


@code {
    [Parameter] public string? Id { get; set; }
    private Pizza? selectedPizza;
    
    protected override async Task OnInitializedAsync()
    {
        var pizzas = await PizzaService.GetPizzasAsync();
        selectedPizza = pizzas.FirstOrDefault(p => p.Id == Id);
    }

    private void HandleOrderReady(Order order)
    {
        // ---- DEĞİŞİKLİK BURADA ----
        // SetOrder (eski) yerine AddPizzaToCart (yeni) metodunu kullanıyoruz
        OrderStateService.AddPizzaToCart(order); 
        // ---- DEĞİŞİKLİK BİTTİ ----
        
        Navigation.NavigateTo("/checkout");
    }
}